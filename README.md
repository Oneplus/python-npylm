# NPYLM

[ベイズ階層言語モデルによる教師なし形態素解析](http://chasen.org/~daiti-m/paper/nl190segment.pdf)のC++実装です。

単語n-gramモデルは3-gramで固定です。2-gramは非対応です。

現在も開発途中です。

## 動作環境

- Boost

## ビルド

```
make install
```

## 実行

```
python train.py -f textfile.txt -l 16
```

### オプション

- -f
	- 学習に使うテキストファイル
- -i
	- 学習に使うテキストファイル群が入っているディレクトリ
	- 複数ファイルを用いる場合はこちらを指定
- -t
	- 読み込んだ行のうち何割を学習に用いるか
	- 0から1の実数を指定
	- 1を指定すると全データを用いてモデルを学習する
- -l
	- 可能な単語の最大長
	- 日本語なら12〜16、英語なら20程度を指定
	- 文の長さをN、単語の最大長をLとすると、NPYLMの計算量はO(NL^3)になる

## 単語分割

```
python viterbi.py -f textfile.txt
```

### オプション

- -f
	- 分割するテキストファイル
- -i
	- 分割するテキストファイル群が入っているディレクトリ
	- 複数ファイルをまとめて分割する場合はこちらを指定
	- ファイルごとに個別の出力ファイルが作成されます

## 注意事項

研究以外の用途には使用できません。

https://twitter.com/daiti_m/status/851810748263157760

また、実装に誤りが含まれる可能性があります。

何かありましたらissueにてお知らせください。

## 展望

現在、[条件付確率場とベイズ階層言語モデルの統合による半教師あり形態素解析](http://chasen.org/~daiti-m/paper/nlp2011semiseg.pdf)を実装しています。

## 実行結果

#### けものフレンズ実況スレ

アンダーフローが起きていないかを確認するためにわざと1行あたりの文字数を多くして学習させています。

15万行あったデータから改行を削除し1万行に圧縮しました。

> / 9話 / が / 割と / 普通 / の / アニメ / だった / ので / 適度に / ハードル / が / 下が / った / 。 / 港 / に / 直行 / し / なかった / のは / 単純に / ボスの / 計画 / 通り / だ / よ / な / うーむ / 人工 / 知能 / に / も / 動物 / の / 本能 / 植え / 込んで / から / ディープ / ラ / ー / ニング / させ / た / ほうが / ほっこ / り / して / いい / かもしれない / かばんちゃん / も / 出 / れ / ない / 可能性 / ある / から / … / わたし / の / 、 / 最高の / フレンズ / キタキツネ / が / お / 風呂 / 前に / ゲーム / に向かって / 怒られ / て / 「 / 一回遊んで / から / ~ / 」 / って / ダダ / こね / て / る / シーン / この / シーン / が / 短い / けど / すごく / ノスタル / ジ / ッ / ク / に / 感じ / た / 子供 / に / 戻 / り / たい / なー / 続く / サーバルちゃん / の / 呼び方 / 見 / る / に / 「 / ク / ワ / トロ / 大尉 / で / 良い / 」 / が / 「 / 大尉 / で / 良い / 」 / なら / 完璧だった / ( / 細かい / オタク / ) / bdでは / 脱いだ / 背中 / くらい / 見 / せ / て / くれ / る / ん / ですかね / ? / 売上 / に / は / 微塵も / 影響 / し / ない / 改変 / だ / けど / おーい / かばん / 人間 / の世界 / に / 帰 / ろう / ディープ / ラ / ー / ニング / の / ai / で / 作 / り / 出 / せ / ない / 芸術 / 作品 / の / 最 / たる / 例 / が / けもフレ / だ / と思う / 
> / 詐欺 / のだ / から / な / 。 / パチンコ / 屋 / の / 客 / は / 脳内 / 麻薬 / 出 / され / て / 、 / いか / さま / 賭博 / で / 搾取 / され / て / いる / かわいそうな / 家畜 / 。 / 現地 / は / フレンズ / 民 / らしき / 人 / 多い / です / w / なんだかんだ / 、 / みんな / 放送中に / 動物園 / に / 1回 / は / 行 / っ / て / る / んだ / よ / ね / 。 / 私 / も / だ / けど / op / 絵の / ポンコツ / さ / が / 微塵もない / 勇ましい / キリン / さん / は / 何 / だった / のか / しかも / 窓の / 怪しい / 人影 / って / 、 / アリツカゲラ / さん / なんだ / ろ / ? / 放送 / 前から / 毎週 / 行 / っ / て / た / わ / 笑 / 最近 / 、 / そう / らしい / よ / ね / 。 / 科学 / 博 / 物館 / なんて / ただ / じゃ無かったっけ / 。 / 子供 / 。 / フェス / の / 辺り / スレ / 見 / れ / なかった / んだ / けど / 盛り / 上 / が / っ / た / の / ? / 遊園地 / に / 偶に / ある / 動物 / 触れ / 合い / コーナー / アンチ / スレ / に / 動物 / 動画 / は / られ / て / る / の / 謎 / で / 草 / 平日の / 午後 / 七時に / 放映 / して / も / 問題 / が / ない / アニメ / だ / な / opで / サーバルちゃん / が / パラ / パラ / を / 踊る / のだ / どうやら / サーバル / にゃん / ライブ / 2日目 / やって / る / 様 / だな / 30 / 0 / 円 / につられて / 行きたい / が、 / ガソリン / 代 / やら何やら / で / 1 / 諭吉 / は / 他の / 所 / に / 飛び / そう / だ / な / w / 無 / 加 / 温 / っぽい / けど / 寒 / く / ない / ん / か / な / ? / サバンナ / 種 / でも / 毛皮 / 有り / は / 適応 / する / のか / パチンコ / … / サバンナ / … / 獣 / 王 / かな / ? / まったく / 問題 / が / 無い / とおもう。 / 年代 / に / よって / とら / え / 方 / が / 変わ / っ / て / いく / だろうし / 。 / マジ / な / は / なし / 、 / 長期 / コンテンツ / を目指す / なら / パチンコ / は / 論外 / 。 / 昨日 / にも / まして / 追い出され / る / な / コウテイ / ペンギン / が / エロい / から / ダメ / です / パラ / パラ / 踊る / 迷探偵 / アミメ / nhk / が / 買い取って / 放送 / して / くれ / ない / か / しら / 今日は祝日 / だから / 仕方 / ない / のだ / 。 / 「 / 羽村 / も / 多摩 / も / すぐ / そば / だ / から / いつでも / 行け / る / 」 / と思って / いる / から / あまり / 行 / か / ない / 罠 / 
> / 別に / 問題 / ない / ような / 気がする / ヒグマ / が / ヒト / を / 食べ / る / の / は / 怖い / こと / は / 怖いけど / 自然なことだ / し / 目の前に / いる / そ / の / フレンズ / の / ヒグマ / ちゃん / が / 自分 / に / 殺 / 気 / を / 向け / て / ない / なら / 別に / いい / かな / って / 単純に / 一緒に / いる / と / 楽しい / サーバルちゃん / ナワバリ / を / 見 / 付け / 、 / そこ / で / 生活 / して / 初めて / フレンド / になれ / る / と思ってる / かばんちゃん / すれ違い / に / 折 / り / あ / い / つく / のか / な / ・・・ / お / よ / よく / さ / マン / も / ある / のか / … / いや / な / 響き / です / わ / 最後 / は / ヒトの / 解説 / する / お兄さん / として / レ / ヴィ / = / スト / ロー / ス / が / 出てくる / ん / でしょ / うちの / 犬 / は / 家 / に / 来 / た / 時 / は / 台所 / で / 落ち / た / 大根 / 食べ / た / り / 段ボール / から / 林檎 / 盗み / 取 / っ / た / り / して / い / た / のに / 今 / は / ステーキ / 肉 / も / 嫌々 / 口 / から / ぽろぽろ / 落 / と / し / ながら / 食べ / る / よ / 余裕 / は / 贅沢 / になる / ん / だな / あ / 、 / と思う / ジャパリ / バイク / で / 颯爽と / 駆け / つけ / て / 欲しい / ね / かばんちゃん / 、 / 仕方がない / とはいえ / 自分の / 事 / で / 手 / 一杯 / で / サーバルちゃん / の / 気持ち / 考え / て / ない / 気がする / 。 / de / の歌詞 / だと / 11話 / で / お互い / の / 本 / 音 / 言い / 合って / みんな / に / 助け / られ / て / き / た / 事 / を / 再 / 確認 / する / パターン / ? / も / ちろん / 20 / 0 / cc / × / 4 / 本 / で / 8 / 0 / 0 / cc / の / 牛乳 / 3 / 食 / だ / よ / 
> / そして / いろいろ / 採 / 掘 / し / よう / 。 / ウラン / とか / 。 / すごい / ね / ー / ! / たのしそ / ー / ! / とか / だけ / 言う / スレ / って / 無い / のか / ? / おれ / あの / 人 / あんまり / 好き / じゃ / なかった / けど / 、 / あまりにも / 衝撃 / すぎ / て / 好き / になったわ / なんj / の / wbc / けもフレ / 実況 / が / そんな感じ / だ / ぞ / なんj / に / たつ / wbc / の / 実況 / スレ / が / そんな / ん / やで / 死ぬ / 時 / は / しっとり / 部屋 / で / ツチノコ / ちゃん / に / 看 / 取 / られ / たい / よ / な / 二人 / は / どういう / ... / 1 / 7 / 歳 / 教 / の / 信者 / め / 3話は / ホント / すごい / と思う / あと / 2クール / で / 収集 / つく / のか / ・・・ / ? / 回収 / し / き / れ / ない / 伏線 / たくさん / 残 / り / そう / だ / な / 俺 / は / サバンナ / の / 草原 / で / 青 / 空 / を / 見 / 上げ / ながら / サーバルちゃん / に / 看 / 取 / られ / たい / 真 / けものフレンズ / で / は / 、 / ボロ / を / 着 / た / ブラック / かばんちゃん / が / 執拗に / 博士 / の / 命 / を / 狙い / ます / 。 / 24クール / に / して / 欲しかった / よ / な / 2クール / もある / わけない / だろ / ! / ! / 2話で終わっちまう / よ / ! / ! / ア / ゛ / ー / ! / 何 / して / ん / だ / オマ / エ / ー / ! /   / ここは / 貴重な / 遺跡 / だ / ぞ / おー! / ? / なんj / 実況 / 楽しい / わ / ディープ / な / ネタ / フリ / に / 語録 / で / 返 / して / くる / 訓練された / フレンズ / も / ゴロゴロ / いる / から / よばんちゃん / すごーい! / は / 若干ゃ草 / 生 / え / た / あと / 2クール / あったら / 大丈夫 / だろ / ・・・ / w / けもフレ / が / あと / 2クール / も / み / られ / る / って / マジ / なの / です / か / !? / ( / 現実逃避 / ラスト / の / 予想 / の / つか / ない / アニオリ / 傑作 / って / ホントに / 極 / ま / れ / にしか / 誕生 / して / くれ / ない / から / フレンズ / として / この / 作品 / に / 出 / 逢え / た / の / は / 奇跡 / ヤオヨロ / ズ / に / いた / とか / いう / 無能 / プロデューサー / 
> / > / ミライさん / は / 『 / 飛んで / 来 / る / 』 / 。 / これ / まめ / な / ジャンプ / 力 / ゥ… / ですかね / 全員 / 全裸 / の / 謎 / 空間 / です / ね / サーバル / は / 自分が / 動物だった頃の / 記憶 / が / あった / から / 泣い / た / のか / ? / 少なくとも / 今 / の段階で / は / 、 / それ / は / 突っ込む / ような / テーマ / で / も / 何で / も / ない / から / な / ジャパリパーク / の / 裏側 / にある / 国 / の / 政治 / 情 / 勢 / なんて / 描写 / し / ない / の / と / 同じ / よ / アプリ / 課金 / し / よう / ぜ / (す / っとぼけ) / 夜行性の / サーバルちゃん / が / 夜中に / じゃぱりまん / 盗み食い / して / る / のは笑った / けものフレンズ / お / わ / っ / た / ら / 不足 / 分 / 補充 / のために / 初めて / 即売会 / とか / 行く / かもしれない / 。 / けもフレ / オンリー / とか / ない / ん / か / おい / シマウマ / を / ナメクジ / 扱い / する / のは / やめ / て / さしあ / げ / よ / 文字 / 読め / ない / し / 夜行性 / だから / 生活リズム / 合 / わ / ない / し / 高い / 所 / 好き / だ / し / 一緒に住む / となると / ほかの / フレンズ / の / ほうが / いい / よ / ね / ・・ / あぁ / 、 / これ / 脱ぐと / つるつる / になる / んだ / ー / ・・・ / 伏線 / だったのか / ! / それ / 貼 / っ / て / よ / 「 / 二期 / で / 会おう / ね / かばんちゃん / 」 / って / サーバル / が / 言う / ラスト / だ / と思う / 。 / 大 / ヒット / した / けど / 続編 / 製作 / され / て / ない / アニメ / も / それなりに / ある / から / ぶっちゃ / け / 製作委員会 / 次第 / としか / ガイドブック / の / 売上 / が / まだ / わから / ない / けど / 、 / 高確率で / 二期 / ある / と思う / よ / 可能性 / ある / ん / だよな / ー / ppp / が / も / っかい / 出てくる / 可能性 / は否定できない / とりあえず / は / bd / を / 買う / こと / だ / 。 / あと / は / 公式 / に / いろいろ / コメント / を / 残 / した / り / かな / 。 / 署 / 名 / 活動 / なんて / の / も / 良い / かもしれない / 。 / メタ / い / ! / メタ / い / よ / ! / セーバル / の / 存在 / を / アピール / し / て / アプリ版 / との繋がり / を / 強調 / し / た / だけ / だったりして / 
> / ユッコシンドローム / なんて / 俺ら / みたいな / 若い / 世代 / に / は / 全く / わから / ない / 話 / だ / よ / な / 殆ど / の / 人 / が / そ / の / 気持ち / で / 通った / 道 / やで / 近代 / 文明 / ぇ / ・・・ / ですかね / 800 / 近い / な / はやく / 追いつく / のです / 急 / 減速 / に / 草 / おいこら / は / 悪い / 文明 / 着ぐるみ / で / 狩 / る / の / なら / まだ / いい / けど / モンハン / って基本的に / パーツ / 運用 / だから / い / か / つい / 装備 / に / 白い / 尻尾 / が / 生 / え / て / た / り / 足 / だけ / モコォ / って / して / た / り / 悲惨な / こと / になって / た / な / マン / 毛 / な / ねえ / 円盤 / どこ / で / 買え / ば / いい / の? / アマゾン / 在庫復活 / し / ない / の? / くそ / 声優 / ぷれ / ー / り / ー / さん / やんけ / ! / カドカワ / ア / マン / ゾ / より / カドカワストア / の / 方が / 良い / らしい / ぞ / 俺は / アン / マゾ / で / 予約 / し / た / けど / 絶体絶命 / 都市 / と / けものフレンズ / の / コラボ / … / なんか / あり / そう / 。 / カワウソ / ちゃん / が / わーい! / 沈んでいく / ぞ / ~ / ! / って / は / しゃ / い / で / て / ジャガーさん / は / 献身 / 的 / に / 救助 / やってて / 皆 / 救助 / のために / 中心 / の / 山 / に / 向かって / る / みたい / な / 。 / 3巻 / は / 予約 / 締め切り / 3 / / / 1 / 7 / まで / だから / まだ間に合う / ぞ / ここ / で / は / 一回 / も / 立て / た / こと / ない / から / やっ / て / みる / よ / モンハン / の / クソ / ゴリラ / とコラボ / して / も / 嬉しくない / っす / よし / 、 / 頑張れ / 。 / 待て / 800 / 踏め / て / ない / ぞ / 。 / スレタイ / の / スペース / 半角 / に / 戻 / して / くだ / さ / ー / ぃ / 立て / て / くれ / ば / ええ / の? / アマゾン / 予約 / でき / ん / し / カドカワ / でき / る / のか / 行 / っ / て / 見 / る / スレタイ / 半角スペース / に / 修正 / 頼む / ヨロシク / ネ / 三└(┐lε:)┘カバンチャーン / ちょっと / 待って / くれ / 。 / さん / がどう / 動く / か / … / 減速 / ~ / 。 / けものフレンズ  / 2 / 1 / 8 / 匹目 /  [無断転載禁止]© / 2ch.net / ごめん / 。 / 混乱 / して / た / 。 / 頼む / 。 / おつ / けもの / ー / ! / テンプレ / も / よろしく / ー / 。 / スレ / を / 完璧に / 立て / て / る / … / ! /   / やっぱり / あれ / は / 乙 / … / ! / 1巻 / は / カドカワ / 今 / 切 / ら / し / とる / ぞ / 残ってる / お / 店 / リスト / は / テンプレ / の / そう / な / ん / か? / カード / 二 / 箱 / 追加 / 発注 / する / わ / テンプレ / を / 頼 / み / たい / 他の / 人 / が / や / る / と / 混乱する / です / 

#### Wikipedia

データ数10万行。

> / the / " / lordmayor / jim / " / charac / ter / was / not / ed / for / answer / ingthe / phone / witha / low / gut / t / ural / " / hell / l / l / l / l / l / l / l / l / l / llo / " / that / quickly / rose / to / an / almost / ear / pierc / ing / pitch / bythe / end / ofthe / word / . / 
> / between / s / r / 6 / 81 / and / harbor / view / road / ( / ex / it / 1 / 6 / 7 / ) / ( / 2 / lane / s / each / way); / 
> / thebook / is / full / of / implic / ation / s / and / red / her / ring / s / and / differ / sfrom / most / murder / myste / ries / in / that / we / are / not / given / a / defini / tive / answer / as / to / what / a / ctually / happen / ed / . / 
> / d / y / s / fun / ction / al / uterine / bleed / ing / is / a / common / causeof / menorrhagia / and / ir / re / gular / bleed / ing / . / 
> / ever / since / then / , / wapol / had / been / travel / ing / in / a / submer / sibles / hip / with / who / m / ever / decid / ed / to / remain / loyal / to / him / . / 
> / pete / r / simp / son / was / born / july / 4 / , / 18 / 71, / in / met / lakatl / a / or / laxkw / ' / alaam / s / ( / a.k. / a / . / 
> / restri / ction / son / their / move / ment / and / permitt / ed / trade / s / vari / ed / ,but / money / l / end / ing / , / run / ning / pawn / shop / s / , / deal / ing / in / second / hand / good / s / and / tail / or / ing / were / common / occup / ation / s. / 
> / opaque / pro / ject / or / s / are / not / as / common / as / the / moder / n / " / over / head / " / . / 
> / film / score / s / , / al / though / they / are / second / ary / to / the / film / , / are / of / ten / critical / lyac / claim / ed / and / very / popular / in / theirown / right / . / 
> / its / wide / central / grave / l / led / walk / led / through / a / central / pa / vil / ion / open / in / four / direction / s / to / a / two- / story / pa / villi / on / set / into / the / far / wall / . / 
>  / richard / bur / rell / is / the / produc / er / , / and / the / other / writer / s / in / volve / d / on / the / first / series / are / paul / cor / nell / , / mark / wad / low / , / de / b / bi / e / o / at / e / s / , / kur / ti / & / do / yle / and / joe / tu / rner / . / 
> / it / serv / ed / asthe / first / super / ior / capital / of / the / jin / dynasty / ( / 11 / 15 / -1234) / between / 1 / 1 / 2 / 2 / to / 1 / 2 / 3 / 4 / ( / and / was / a / second / ary / capital / after / 1 / 1 / 7 / 3 / ) / until / the / capital / was / moved / to / yan / j / ing / ( / now / beijing / ) / in / 1 / 1 / 5 / 3 / by / wan / yan / liang / ,the / fourth / emperor / ofthe / dynasty / , / despite / op / position / from / his / minister / s / . / 
> / the / two / friend / s / from / banglades / h / became / celeb / r / ities / from / their / frequen / t / appearan / ce / s / onthe / show / and / act / ed / as / " / dave / 's / ambassad / or / s / " / when / he / sent / them / ona / tour / ofthe / unitedstate / s / . / 
> / it / is / believe / d / the / swoop / bike / s / first / origin / ated / on / tar / is / , / where / swoop / racing / captured / the / imag / in / ation / of / the / galaxy / circa / 4,000 / b / by / . / 
> / it / is / the / result / of / thenew / zealand / fire / service / act / ( / 1975 / ) / which / national / is / ed / the / various / district / - / level / brigade / s / which / had / developed / across / thecount / ry / . / 
viterbi:
> / the / league / of / n / ations / adopt / ed / several / drug / control / treat / ies / priorto / world / warii / speci / fy / ing / uni / form / control / s / on / addi / ctive / drug / s / such / as / co / caine / , / opium / , / and / its / deri / vatives / . / 
> / wo / ul / -fm / , / ir / on / ton / , / 8 / 9 / . / 1 / f / m / ( / the / " / l / " / is / from / law / rence / co / . / ); / 
> / as / he / put / it / , / al / though / " / ... / n / either / ko / ran / or / s / ultan / en / join / the / death / of / jew / or / christian / in / t / rud / ing / with / in / the / column / s / that / not / e / the / sanctua / ry / limit / s / , / not / hing / could / save / a / european / detect / ed / by / the / popul / ace / , / or / one / who / after / pilgri / m / age / declare / d / himself / an / un / believe / r / ." / the / pilgri / m / age / entitl / ed / him / to / the / title / of / h / aj / j / i / and / to / wear / a / green / t / urban / . / 
> / hewas / the / first / jewish / president / and / won / ina / land / slide / . / 
> / they / releas / ed / on / elp / in / 1965 / and / numerous / subse / quent / 45 / - / only / releas / e / s / . / 